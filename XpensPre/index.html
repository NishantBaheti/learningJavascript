<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Expense App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      defer
      src="https://use.fontawesome.com/releases/v5.7.2/js/all.js"
      integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Xpens</a>
      </div>
    </nav>
    <div class="container-fluid bg-light" style="min-height: 100vh">
      <div class="container">
        <div class="jumbotron mt-4">
          <h5>
            Monthly Expense
            <span id="totalExpense" class="badge bg-secondary"></span>
          </h5>
          <div class="input-group mb-3">
            <input
              type="text"
              class="form-control"
              placeholder="Enter Amount"
              aria-label="Enter Amount"
              aria-describedby="basic-addon2"
              id="inputAmount"
            />
            <span class="input-group-text" id="basic-addon2">Rs.</span>
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon2">spent on</span>
            <input
              type="text"
              class="form-control"
              placeholder="Description"
              aria-label="Description"
              aria-describedby="basic-addon2"
              id="inputDescription"
            />
          </div>
          <button type="button" class="btn btn-dark" id="btnAddExpense">
            Add
          </button>
        </div>
        <div>
          <ul class="list-group" id="expenseTable"></ul>
        </div>
      </div>
    </div>
    <script>
      const totalExpenseEl = document.querySelector("#totalExpense");
      const inputAmountEl = document.querySelector("#inputAmount");
      const inputDescriptionEl = document.querySelector("#inputDescription");
      const addExpenseEl = document.querySelector("#btnAddExpense");
      const tableElement = document.querySelector("#expenseTable");

      let totalExpense = 0;
      let expenseArr = [];

      totalExpenseEl.textContent = totalExpense;

      function refreshExpenseTable(arr) {
        const allExpenses = arr.map((expense) =>
        
          createListItem(expense)
        );

        tableElement.innerHTML = allExpenses.join("");
      }

      function refreshTotalExpense(value){
        totalExpenseEl.textContent = value;
      }


      function addExpenseToTotal() {
        const textAmount = inputAmountEl.value;
        const expenseDescription = inputDescriptionEl.value;
        const expenseAmount = parseFloat(textAmount);
        const dateValue = new Date();

        if (expenseAmount) {
          expenseArr.push({
            tick: dateValue.getTime(),
            amount: expenseAmount,
            desc: expenseDescription,
            date: dateValue,
          });
          totalExpense += expenseAmount;
          refreshExpenseTable(expenseArr);
        }
        refreshTotalExpense(totalExpense);
      }

      
      function deleteRecord(tick) {
        const filteredArray = [];
        for (let i = 0; i < expenseArr.length; i++) {
          if (expenseArr[i].tick === tick) {
            // console.log(expenseArr[i]);
            totalExpense -= expenseArr[i].amount;
          } else {
            filteredArray.push(expenseArr[i]);
          }
        }
        
        expenseArr = filteredArray;
        refreshTotalExpense(totalExpense);
        refreshExpenseTable(expenseArr);
      }

      function getMomentString(date) {
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      function createListItem({ desc, amount, date, tick }) {
        return `
        <li class="list-group-item d-flex justify-content-between">
          <div class="d-flex flex-column">
            ${desc}
            <small class="text-muted">${getMomentString(date)}</small>
          </div>
          <div>
            <span class="px-5">
              ${amount} Rs.
            </span>
            <button type="button" onclick=deleteRecord(${tick}) class="btn btn-outline-danger btn-sm">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </li>`;
      }

      addExpenseEl.addEventListener("click", addExpenseToTotal, false);
    </script>
  </body>
</html>
